<!doctype html>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>data-popover example</title>
<link rel="stylesheet" href="data-popover.css" />
<script src="data-popover.js"></script>
<script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.6/dist/htmx.min.js"></script>

<style>
  main {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2rem;
    padding: 2rem;
  }

  .dark-theme [data-popover] + [popover] {
    --border-color: #444;
    --bg-color: #1a1a1a;
    color: #e0e0e0;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
  }

  #placement {
    button {
      padding: 1em 0.5em;
      width: 100%;
    }

    display: flex;
    flex-direction: column;
    gap: 1em;

    > div {
      display: flex;
      gap: 2em;
      justify-content: space-between;
    }
    .stretch {
      display: flex;
      gap: 1em;

      > div {
        display: flex;
        flex-direction: column;
        gap: 1em;
        justify-content: space-between;
      }
    }
  }
</style>

<main>
  <h1>data-popover</h1>

  <h2>HTMx</h2>

  <button data-popover>Load by HTMx</button>
  <div popover hx-get="/" hx-trigger="data-popover:show">Loading ...</div>

  <h2>Placement</h2>
  <section id="placement">
    <div>
      <button data-popover="top-start">top-start</button>
      <div popover="manual">Popover</div>

      <button data-popover="top">Top</button>
      <div popover="manual">Popover</div>

      <button data-popover="top-end">top-end</button>
      <div popover="manual">Popover</div>
    </div>

    <div class="stretch">
      <div>
        <button data-popover="left-start">left-start</button>
        <div popover="manual">Popover</div>

        <button data-popover="left">left</button>
        <div popover="manual">Popover</div>

        <button data-popover="left-end">left-end</button>
        <div popover="manual">Popover</div>
      </div>

      <div>
        <button data-popover="right-start">right-start</button>
        <div popover="manual">Popover</div>

        <button data-popover="right">right</button>
        <div popover="manual">Popover</div>

        <button data-popover="right-end">right-end</button>
        <div popover="manual">Popover</div>
      </div>
    </div>

    <div>
      <button data-popover="bottom-start">bottom-start</button>
      <div popover="manual">Popover</div>

      <button data-popover="bottom">bottom</button>
      <div popover="manual">Popover</div>

      <button data-popover="bottom-end">bottom-end</button>
      <div popover="manual">Popover</div>
    </div>

    <script>
      document.currentScript.parentElement
        .querySelectorAll("[data-popover]")
        .forEach((el) => el.click());
    </script>
  </section>

  <h2>Normal</h2>
  <button data-popover>Bottom (default)</button>
  <div popover>Popover on the bottom</div>

  <button data-popover="right">Right</button>
  <div popover>Popover on the right</div>

  <button data-popover="left">Left</button>
  <div popover>Popover on the left</div>

  <button data-popover="top">Top (data attributes)</button>
  <div popover>Popover on the top</div>

  <h2>Hover Triggers</h2>
  <p>
    Popovers can be triggered by hover or click. Use the following attributes:
  </p>
  <ul>
    <li><code>data-popover-trigger="hover"</code> - Show on hover</li>
    <li><code>data-popover-trigger="click"</code> - Show on click (default)</li>
    <li>
      <code>data-popover-hover-delay="500"</code> - Delay before showing on
      hover (ms)
    </li>
    <li>
      <code>data-popover-hover-out-delay="100"</code> - Delay before hiding on
      mouse leave (ms, default: 100)
    </li>
  </ul>
  <p>
    <strong>Note:</strong> Hover popovers stay open when you move your mouse
    between the trigger and the popover content. The default 100ms hide delay
    provides a grace period for traversing any gap between them.
  </p>
  <p>
    <strong>Touch devices:</strong> Hover triggers automatically fall back to
    click on touch devices for better usability.
  </p>

  <button data-popover data-popover-trigger="hover" data-popover="right">
    Hover me
  </button>
  <div popover>I appear on hover!</div>

  <button
    data-popover
    data-popover-trigger="hover"
    data-popover-hover-delay="500"
    data-popover="bottom"
  >
    Hover with delay
  </button>
  <div popover>I appear after 500ms!</div>

  <button
    data-popover
    data-popover-trigger="hover"
    data-popover-hover-out-delay="0"
    data-popover="left"
  >
    Instant hide
  </button>
  <div popover>I hide immediately when mouse leaves (no grace period)</div>

  <h2 id="theming">Theming</h2>
  <p>
    Customize popover appearance using CSS custom properties. Here's a dark
    theme:
  </p>

  <div
    class="dark-theme"
    style="
      background: #2a2a2a;
      padding: 2rem;
      border-radius: 8px;
      margin: 1rem 0;
    "
  >
    <button
      data-popover
      style="background: #444; color: #fff; border: 1px solid #666"
    >
      Dark Theme
    </button>
    <div popover>I'm a dark themed popover!</div>

    <button
      data-popover
      data-popover-trigger="hover"
      data-popover="right"
      style="
        background: #444;
        color: #fff;
        border: 1px solid #666;
        margin-left: 1rem;
      "
    >
      Hover Dark
    </button>
    <div popover>Dark theme works with all features</div>
  </div>

  <details style="margin: 1rem 0">
    <summary>How to create a dark theme</summary>
    <pre
      style="
        background: #f5f5f5;
        padding: 1rem;
        border-radius: 4px;
        overflow-x: auto;
      "
    >
/* Dark theme CSS */
.dark-theme [data-popover-popover] {
  --data-popover-border-color: #444;
  --data-popover-bg-color: #1a1a1a;
  color: #e0e0e0;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
}</pre
    >
  </details>

  <div
    style="
      margin: 3rem 0;
      padding: 2rem;
      border: 2px dashed #ccc;
      border-radius: 8px;
    "
  >
    <h2>Dynamic Content Example</h2>
    <p>Click the button below to add new popover triggers dynamically:</p>
    <button id="add-popover-btn" style="margin: 1rem 0">
      Add Dynamic Popover
    </button>
    <div
      id="dynamic-popovers"
      style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem"
    ></div>
  </div>

  <div
    style="
      margin: 3rem 0;
      padding: 2rem;
      border: 2px dashed #ccc;
      border-radius: 8px;
    "
  >
    <h2>Nested Popovers</h2>
    <button data-popover>Open Parent Popover</button>
    <div popover>
      <p>This is the parent popover.</p>
      <button data-popover data-popover="right">Open Nested Popover</button>
      <div popover>This is a nested popover!</div>
    </div>
  </div>
</main>

<script>
  // Demo: Add dynamic popovers
  let dynamicCount = 0;
  document.getElementById("add-popover-btn").addEventListener("click", () => {
    dynamicCount++;
    const container = document.getElementById("dynamic-popovers");

    // Create button and popover pair
    const button = document.createElement("button");
    button.setAttribute("data-popover", "");
    button.setAttribute(
      "data-popover",
      ["top", "right", "bottom", "left"][dynamicCount % 4],
    );

    // Mix of trigger types for demo
    if (dynamicCount % 2 === 0) {
      button.setAttribute("data-popover-trigger", "hover");
      button.textContent = `Dynamic ${dynamicCount} (hover)`;
    } else {
      button.textContent = `Dynamic ${dynamicCount} (click)`;
    }

    const popover = document.createElement("div");
    popover.setAttribute("popover", "");
    popover.textContent = `I'm dynamic popover #${dynamicCount}!`;

    container.appendChild(button);
    container.appendChild(popover);
  });
</script>
